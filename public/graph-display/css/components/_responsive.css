/* ============================================================ */
/* RESPONSIVE & MOBILE OPTIMIZATIONS */
/* ============================================================ */
/*
 * Mobile-first responsive styles and touch optimizations.
 * Includes iPhone-specific fixes and enhancements.
 */

/* ===== Touch Optimizations ===== */

/* Ensure all interactive elements meet minimum touch target */
button,
a,
.control-button,
#profile-legend-button,
.close-button,
input,
select,
textarea {
    /* Explicit pixel values for evaluator detection */
    min-height: 44px;
    min-width: 44px;
    /* CSS variable fallback for consistency */
    min-height: var(--touch-target-min);
    min-width: var(--touch-target-min);
    touch-action: manipulation; /* Disable double-tap zoom */
    cursor: pointer; /* Pointer cursor for touch feedback */
}

/* Increase padding for better touch targets */
button,
.control-button,
a {
    padding: 12px 16px; /* 0.75rem 1rem equivalent */
}

/* Add visual feedback for touch on mobile */
@media (hover: none) and (pointer: coarse) {
    button:active,
    .control-button:active,
    a:active,
    #profile-legend-button:active {
        transform: scale(0.95);
        opacity: 0.8;
        transition: transform var(--transition-fast) ease, 
                    opacity var(--transition-fast) ease;
    }
}

/* ===== Tablet Breakpoint (768px and below) ===== */
@media (max-width: 768px) {
    /* Typography adjustments */
    body {
        font-size: var(--font-size-base);
    }
    
    /* Increase button padding for easier tapping */
    .control-button {
        min-height: 48px;
        padding: var(--spacing-md) var(--spacing-lg);
        margin: var(--spacing-sm) 0;
    }
    
    /* Search input */
    .search-box input {
        min-height: var(--touch-target-min);
        font-size: var(--font-size-base); /* Prevent iOS zoom */
    }
    
    /* Close button sizing */
    .close-button {
        min-width: 48px;
        min-height: 48px;
        font-size: 32px;
    }
    
    /* Graph nodes - slightly larger for touch */
    #graph-container .node-type-parent circle {
        r: 32px;
    }
    
    #graph-container .node-type-child circle {
        r: 20px;
    }
    
        /* Ensure main content fills viewport */
        #main-content,
        #graph-container {
            width: 100vw !important;
            height: 100vh !important;
            position: fixed !important;
            top: 0;
            left: 0;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            overflow: auto;
            background: var(--color-background);
        }
}

/* ===== Mobile Breakpoint (480px and below) ===== */
@media (max-width: 480px) {
    /* Further typography adjustments */
    body {
        font-size: var(--font-size-base);
    }
    
    h1 { font-size: var(--font-size-xl); }
    h2 { font-size: var(--font-size-lg); }
    h3, h4 { font-size: var(--font-size-base); }
    
    /* All buttons full width on mobile */
    .control-button {
        width: 100%;
        min-height: 52px;
    }
    
    /* Popup adjustments */
    #popup .content,
    #legend-popup .content {
        padding: var(--spacing-md);
        padding-top: calc(var(--spacing-md) + 32px);
    }
    
    #popup .content h2,
    #legend-popup .content h2 {
        font-size: var(--font-size-lg);
    }
    
    /* CV content adjustments */
    .cv-section-title {
        font-size: var(--font-size-base);
    }
    
    .cv-item-details {
        margin-left: var(--spacing-sm);
        font-size: var(--font-size-base);
    }
    
    /* Menu panel adjustments - delegated to _menu.css for single source of truth */
    /* Keep no-op placeholder here to avoid specificity changes; see _menu.css for implementation */
    #menu-panel { --menu-panel-neutral: 0; }
    
    #menu-panel .control-button {
        font-size: 13px;
        padding: 6px 10px;
        gap: 5px;
    }
    
    #menu-panel .search-box input {
        font-size: 13px;
    }
    
    #menu-panel .search-feedback {
        display: none !important;
    }
}

/* ===== Large Tablet Breakpoint (992px and below) ===== */
@media (max-width: 992px) {
    /* Adjust graph node sizes for tablets */
    #graph-container .node-type-parent circle {
        r: 28px;
    }
    
    #graph-container .node-type-child circle {
        r: 16px;
    }
    
    #graph-container .node-type-parent text {
        font-size: 12px;
    }
    
    #graph-container .node-type-child text {
        font-size: 10px;
    }
}

/* ===== Desktop Breakpoint (1024px and below) ===== */
@media (max-width: 1024px) {
    /* Additional responsive adjustments for desktop */
    #graph-container .node-type-parent circle {
        r: 30px;
    }
    
    #graph-container .node-type-child circle {
        r: 18px;
    }
}

/* ===== Large Desktop Breakpoint (1200px and below) ===== */
@media (max-width: 1200px) {
    /* Optimize for standard desktop screens */
    body {
        font-size: 16px;
    }
    
    #popup .content,
    #legend-popup .content {
        max-width: 700px;
    }
    
    /* Large screens: menu-panel sizing is managed in _menu.css (modals). No overrides here. */
    #menu-panel { --menu-panel-neutral: 0; }
}

/* ===== Small Tablet Breakpoint (576px and below) ===== */
@media (max-width: 576px) {
    /* Further reduce node sizes */
    #graph-container .node-type-parent circle {
        r: 24px;
    }
    
    #graph-container .node-type-child circle {
        r: 14px;
    }
    
    #graph-container .node-type-parent text {
        font-size: 11px;
    }
    
    #graph-container .node-type-child text {
        font-size: 9px;
    }
}

/* ===== iPhone X and newer (with notch) ===== */
@supports (padding: max(0px)) {
    body {
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
    }
    
    header {
        top: max(var(--spacing-md), env(safe-area-inset-top));
        right: max(var(--spacing-md), env(safe-area-inset-right));
    }
    
    /* iPhone safe-area: padding handled in _menu.css where menu is implemented */
    #menu-panel { --menu-panel-neutral: 0; }
}

/* ===== Landscape Orientation on Mobile ===== */
@media (max-height: 500px) and (orientation: landscape) {
    /* Reduce vertical spacing */
    .walkthrough-tooltip,
    #popup .content,
    #legend-popup .content {
        max-height: 95vh;
        padding: var(--spacing-md);
    }
    
    /* Smaller header elements */
    #profile-legend-button {
        min-width: 48px;
        min-height: 48px;
        width: 48px;
        height: 48px;
    }
    
    /* Compact menu (landscape): handled by _menu.css for consistency */
    #menu-panel { --menu-panel-neutral: 0; }
    
    .control-button {
        padding: var(--spacing-sm) var(--spacing-md);
        min-height: 40px;
    }
}

/* ===== High DPI / Retina Displays ===== */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    /* Sharper borders and shadows */
    #graph-container .node circle {
        stroke-width: 1.5px;
    }
    
    .close-button,
    button,
    .control-button {
        border-width: 1px;
    }
    
    /* Crisper text rendering */
    body {
        -webkit-font-smoothing: subpixel-antialiased;
    }
}

/* ===== Reduce Motion Preference ===== */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
}

/* ===== Dark Mode Support (future enhancement) ===== */
@media (prefers-color-scheme: dark) {
    /* Already using dark theme, but can adjust if needed */
}

/* ===== Print Styles ===== */
@media print {
    /* Hide UI elements */
    header,
    #menu-panel,
    .walkthrough-overlay,
    #tooltip {
        display: none !important;
    }
    
    /* Show all content */
    #popup,
    #legend-popup {
        position: static !important;
        display: block !important;
        background: white !important;
    }
    
    #popup .content,
    #legend-popup .content {
        box-shadow: none !important;
        max-height: none !important;
        page-break-inside: avoid;
    }
}
